(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a3c35a56"],{"6c1e":function(e,t,n){"use strict";n("ad46")},a619:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.dialogVisible?n("vxe-modal",{attrs:{title:"办理轨迹",width:"60%",height:"60vh","esc-closable":"","show-zoom":"",resize:""},model:{value:e.dialogVisible,callback:function(t){e.dialogVisible=t},expression:"dialogVisible"}},[n("el-tabs",{attrs:{"tab-position":"top"},on:{"tab-click":e.handleTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{name:"zzGc"}},[n("span",{attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"el-icon-date"}),e._v(" 追踪过程")]),"zzGc"===e.activeName?n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.historyList,border:"","header-cell-style":{background:"#d0cece",color:"#000000",fontWeight:"bold"}}},[n("el-table-column",{attrs:{label:"序号",align:"center",type:"index"}}),n("el-table-column",{attrs:{align:"center",prop:"taskName",label:"节点名称",width:"180"}}),n("el-table-column",{attrs:{align:"center",prop:"endTime",label:"执行时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(e.formatTime(t.row.endTime||t.row.startTime)))])]}}],null,!1,4221860926)}),n("el-table-column",{attrs:{align:"center",prop:"nickName",label:"执行人",width:"180"}}),n("el-table-column",{attrs:{align:"center",prop:"comment",label:"审核意见"}})],1):e._e()],1),n("el-tab-pane",{attrs:{name:"spLc"}},[n("span",{attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"el-icon-date"}),e._v(" 审批流程图")]),[n("div",[n("div",{staticClass:"bpmn-viewer-container"},[n("div",{staticStyle:{position:"absolute","z-index":"99999999999",right:"0"}},[n("el-button-group",{key:"scale-control"},[n("el-tooltip",{attrs:{effect:"light",content:"缩小视图"}},[n("el-button",{attrs:{size:e.headerButtonSize,disabled:e.defaultZoom<.2,icon:"el-icon-zoom-out"},on:{click:function(t){return e.processZoomOut()}}})],1),n("el-button",{attrs:{size:e.headerButtonSize}},[e._v(e._s(Math.floor(10*this.defaultZoom*10)+"%"))]),n("el-tooltip",{attrs:{effect:"light",content:"放大视图"}},[n("el-button",{attrs:{size:e.headerButtonSize,disabled:e.defaultZoom>4,icon:"el-icon-zoom-in"},on:{click:function(t){return e.processZoomIn()}}})],1),n("el-tooltip",{attrs:{effect:"light",content:"重置视图并居中"}},[n("el-button",{attrs:{size:e.headerButtonSize,icon:"el-icon-c-scale-to-original"},on:{click:function(t){return e.processReZoom()}}})],1)],1)],1),n("div",{ref:"canvas",staticStyle:{width:"100%",height:"400px",margin:"0 auto"},attrs:{id:"bpmnCanvas"}}),n("Popover",{ref:"flowMsgPopover",attrs:{overlayClassName:"flowMsgPopover",visible:!0},scopedSlots:e._u([{key:"title",fn:function(){return[n("h1",{staticClass:"popover-title"},[e._v(e._s(e.detailInfo.name))])]},proxy:!0},{key:"content",fn:function(){return[null!=e.detailInfo.activityName&&""!==e.detailInfo.activityName&&"undefined"!==e.detailInfo.activityName?n("p",[e._v("节点名称："+e._s(e.detailInfo.activityName||""))]):e._e(),n("p",e._l(e.detailInfo.approver.split(";"),(function(t){return null!=e.detailInfo.activityName&&""!==e.detailInfo.activityName&&"undefined"!==e.detailInfo.activityName?n("Tag",{key:t,staticStyle:{"margin-right":"4px","margin-bottom":"4px"},attrs:{color:"processing"}},[e._v(e._s(t)+" ")]):e._e()})),1),null!=e.detailInfo.activityName&&""!==e.detailInfo.activityName&&"undefined"!==e.detailInfo.activityName?n("p",[e._v("执行时间："+e._s(e.formatTime(e.detailInfo.endTime)||""))]):e._e()]},proxy:!0}],null,!1,3960692441)})],1)])]],2)],1)],1):e._e()},o=[],a=n("c7eb"),l=n("1da1"),r=(n("d9e2"),n("99af"),n("14d9"),n("fb6a"),n("b0c0"),n("d3b7"),n("4d63"),n("c607"),n("ac1f"),n("2c3e"),n("25f0"),n("466d"),n("5319"),n("0643"),n("4e3e"),n("159b"),n("ff02")),c=n("b775");function s(e){return Object(c["a"])({url:"/task/selectHistory",method:"get",params:e})}var d=n("7571"),u=n("8592"),h=n("681b"),f=n("5efb"),m=n("1d87"),p=n("7071"),g=n("8520"),v=n("88eb"),b=n("041f"),y=null,w={props:{headerButtonSize:{type:String,default:"small",validator:function(e){return-1!==["default","medium","small","mini"].indexOf(e)}},reviewObj:{type:Object}},components:{Tag:d["a"],Spin:u["a"],Popover:h["a"],Button:f["a"],Space:m["a"],Affix:p["a"],RadioButtonGroup:f["a"].RadioButtonGroup,PlusCircleOutlined:g["PlusCircleOutlined"],MinusCircleOutlined:g["MinusCircleOutlined"],OneToOneOutlined:g["OneToOneOutlined"]},data:function(){return{bpmnViewer:null,container:null,canvas:null,dialogVisible:!1,rowData:null,pictureXml:null,activeName:"zzGc",historyList:[],detailInfo:{approver:""},executedLightNode:[],highlightLine:[],activeLightNode:[],modelName:"",defaultZoom:1,nodeDetail:{},scale:1,title:"流程预览",instanceId:void 0}},mounted:function(){this.initPage(this.instanceId)},created:function(){},methods:{handleTabClick:function(e,t){console.log("当前标签页名称:",e.name),"spLc"===e.name&&this.initPage(this.instanceId),console.log("触发事件:",t)},initPage:function(e,t){var n=this,i=this.$refs.canvas;y&&y.destroy(),y=new v["a"]({container:i,width:"100%",additionalModules:[b["a"]]}),this.instanceId=e;document.getElementsByTagName("svg").length;(e||t)&&Object(r["c"])({instanceId:e,procDefId:t}).then((function(e){200===e.code?(n.title=e.data.modelName,n.highlightLine=e.data.highlightedFlowIds,n.executedLightNode=e.data.executedActivityIds,n.activeLightNode=e.data.activeActivityIds,y&&n.importXml(e.data.modelXml)):n.$message({message:e.data.msg,type:"error"})}))},getHtmlAttr:function(e,t,n){var i=[],o="<"+t+"[^<>]*?\\s"+n+"=['\"]?(.*?)['\"]?\\s.*?>",a=e.match(new RegExp(o,"gi"));return a&&a.forEach((function(e){e&&i.push(e)})),i},importXml:function(e){var t=this;return Object(l["a"])(Object(a["a"])().mark((function n(){var i,o;return Object(a["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:i=t.getHtmlAttr(e,"exclusiveGateway","id"),o=e,i&&i.length>0&&i.forEach((function(e){var t=new RegExp('id="(.+?)"').exec(e);t&&t[1]&&(o=o.replace('bpmnElement="'+t[1]+'"','bpmnElement="'+t[1]+'" isMarkerVisible="true"'))})),y.importXML(o,(function(e){e?console.error(e,1111):t.importXmlSuccess()}));case 4:case"end":return n.stop()}}),n)})))()},importXmlSuccess:function(){var e=y.get("canvas");e.zoom("fit-viewport","auto"),e.zoom(1.02),this.setViewerStyle(e),this.bindEvents()},setViewerStyle:function(e){var t=this.highlightNode;t&&t.length>0&&t.forEach((function(t){e.addMarker(t,"highlight");var n=document.querySelector(".highlight").querySelector(".djs-visual rect");n&&n.setAttribute("stroke-dasharray","4,4")}));var n=this.highlightLine;n&&n.length>0&&n.forEach((function(t){e.addMarker(t,"highlight-line")}));var i=this.executedLightNode;i&&i.length>0&&i.forEach((function(t){e.addMarker(t,"highlight-executed")}));var o=this.activeLightNode;o&&o.length>0&&(o.forEach((function(t,n){e.addMarker(t,"highlight")})),document.querySelectorAll(".highlight").forEach((function(e,t){e.querySelector(".djs-visual rect").setAttribute("stroke-dasharray","4,4")})))},genNodeDetailBox:function(e,t){var n=document.createElement("div"),i=document.querySelector(".flowMsgPopover");console.log(this.detailInfo),n.innerHTML=i.innerHTML,n.className="tipBox",n.style.width="260px",n.style.background="rgba(185,181,181,0.6)",t.add(e.element.id,{position:{top:e.element.height,left:0},html:n})},bindEvents:function(){var e=this,t=y.get("eventBus"),n=y.get("overlays");t.on("element.hover",(function(t){"bpmn:UserTask"===t.element.type&&e.nodeDetail[t.element.id]&&(e.detailInfo=e.nodeDetail[t.element.id],setTimeout((function(){console.log("节点类型:"+t.element.type),"bpmn:UserTask"===t.element.type&&e.genNodeDetailBox(t,n)}),10))})),t.on("element.out",(function(e){n.clear()}))},processZoomIn:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,t=Math.floor(100*this.defaultZoom+100*e)/100;if(t>4)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be greater than 4");this.defaultZoom=t,y.get("canvas").zoom(this.defaultZoom)},processZoomOut:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,t=Math.floor(100*this.defaultZoom-100*e)/100;if(t<.2)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be less than 0.2");this.defaultZoom=t,y.get("canvas").zoom(this.defaultZoom)},processReZoom:function(){this.defaultZoom=1,y.get("canvas").zoom("fit-viewport","auto")},formatTime:function(e){var t=new Date(e),n=t.getFullYear(),i=("0"+(t.getMonth()+1)).slice(-2),o=("0"+t.getDate()).slice(-2),a=("0"+t.getHours()).slice(-2),l=("0"+t.getMinutes()).slice(-2),r=("0"+t.getSeconds()).slice(-2);return"".concat(n,"-").concat(i,"-").concat(o," ").concat(a,":").concat(l,":").concat(r)},handleOpen:function(e){var t=this;this.activeName="zzGc",this.dialogVisible=!0,this.rowData=e,this.pictureXml=null,setTimeout((function(){t.getXmlData()}),10)},getXmlData:function(){var e=this;this.instanceId=this.rowData.processInstanceId,this.initPage(this.rowData.processInstanceId,null),s({processInstanceId:this.rowData.processInstanceId}).then((function(t){e.historyList=t.data})).catch((function(e){console.error("获取历史记录时出错:",e)}))}}},I=w,N=(n("6c1e"),n("2877")),k=Object(N["a"])(I,i,o,!1,null,null,null);t["default"]=k.exports},ad46:function(e,t,n){},ff02:function(e,t,n){"use strict";n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return a})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return r})),n.d(t,"f",(function(){return c})),n.d(t,"c",(function(){return s}));var i=n("b775");function o(e){return Object(i["a"])({url:"/processDefinition/list",method:"get",params:e})}function a(e){return Object(i["a"])({url:"/processDefinition/suspendOrActiveApply",method:"post",data:e})}function l(e,t){return Object(i["a"])({url:"/processDefinition/remove/"+e+"/"+t,method:"delete"})}function r(e){return Object(i["a"])({url:"/processDefinition/getDefinitionXML",method:"get",params:e})}function c(e){return Object(i["a"])({url:"/processDefinition/uploadStreamAndDeployment2",method:"post",data:e})}function s(e){return Object(i["a"])({url:"/processDefinition/getHighLightedNodeVoByProcessInstanceId",method:"get",params:{instanceId:e.instanceId,procDefId:e.procDefId}})}}}]);